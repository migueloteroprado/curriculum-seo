const MAX_WORDS=150;(function(){window.addEventListener("load",()=>{new Main();var lazyImages=[].slice.call(document.querySelectorAll("img.lazy"));if("IntersectionObserver" in window){let lazyImageObserver=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){if(entry.isIntersecting){let lazyImage=entry.target;lazyImage.src=lazyImage.dataset.src;lazyImage.classList.remove("lazy");lazyImageObserver.unobserve(lazyImage)}})});lazyImages.forEach(function(lazyImage){lazyImageObserver.observe(lazyImage)})}})})();class Main{constructor(){new Index()}}class Index{constructor(){this.oNavegacion=new Navegacion('index');this.oFormContact=new ContactForm();this.oFotoQuienSoy=document.querySelector('.foto-quien-soy');this.wrapperAmpliarReducirFoto=document.querySelector(".wrapper-foto");this.icomAmpliarReducirFoto=document.querySelector(".wrapper-foto .fa-stack-1x");this.defineEventListeners()};defineEventListeners(){this.wrapperAmpliarReducirFoto.addEventListener('click',this.ampliarFoto.bind(this))};ampliarFoto(event){if(this.oFotoQuienSoy.classList.contains('ampliada')){this.oFotoQuienSoy.classList.remove('ampliada');this.oFotoQuienSoy.setAttribute('src','./assets/maop.jpg');this.icomAmpliarReducirFoto.classList.toggle('fa-search-minus');this.icomAmpliarReducirFoto.classList.toggle('fa-search-plus')}else{this.oFotoQuienSoy.classList.add('ampliada');this.oFotoQuienSoy.setAttribute('src','./assets/maop-big.jpg');this.icomAmpliarReducirFoto.classList.toggle('fa-search-plus');this.icomAmpliarReducirFoto.classList.toggle('fa-search-minus')}}}class Navegacion{constructor(pagina){this.pagina=pagina;this.menu=document.querySelector("#menu");this.menuIcon=document.querySelector('.menu-icon');this.navSecciones=document.querySelectorAll('.menu-principal a');this.secciones=document.querySelectorAll("section");this.btnInicio=document.querySelector("#btn-inicio");if(this.pagina=='index'){this.portadaNombre=document.querySelector("main section.home header h2");this.portadaCurriculum=document.querySelector("main section.home header h3");this.portadaFoto=document.querySelector("main section.home header img")}this.offsets=[];this.defineEventListeners();this.prepararNavegacion();this.scrollController();this.smoothScrollHandler=new SmoothScroll()}defineEventListeners(){this.navSecciones.forEach(enlaceSeccion=>{enlaceSeccion.addEventListener('click',(event)=>{const enlace=event.currentTarget.getAttribute('data-enlace');if(enlace){event.preventDefault();this.smoothScrollHandler.smoothScroll(event.currentTarget.getAttribute('data-enlace'))}})});this.btnInicio.addEventListener('click',(event)=>{event.preventDefault();this.smoothScrollHandler.smoothScroll(event.currentTarget.getAttribute('data-enlace'))});this.menuIcon.addEventListener('click',(event)=>{event.preventDefault();this.menu.classList.toggle('menu-visible')});window.addEventListener('resize',this.prepararNavegacion.bind(this));window.addEventListener('orientationchange',this.prepararNavegacion.bind(this));window.addEventListener('scroll',this.scrollController.bind(this));document.body.addEventListener('click',this.closeMenu.bind(this))};closeMenu(event){event.stopPropagation();const tipoNodo=event.target.nodeName;if(this.menu.classList.contains('menu-visible')&&tipoNodo!='A'&&tipoNodo!='I'){this.menu.classList.remove('menu-visible')}}scrollController(){if(this.pagina=='index'){let desplazamiento=10;let pageOffset=window.pageYOffset+Math.max(100,window.innerHeight/desplazamiento);let menuItem=0;if(pageOffset>=this.offsets['#home']&&pageOffset<this.offsets['#quien-soy']){menuItem=0}else if(pageOffset>=this.offsets['#quien-soy']&&pageOffset<this.offsets['#estudios']){menuItem=1}else if(pageOffset>=this.offsets['#estudios']&&pageOffset<this.offsets['#experiencia']){menuItem=2}else if(pageOffset>=this.offsets['#experiencia']&&pageOffset<this.offsets['#contacto']){menuItem=3}else{menuItem=4};this.navSecciones.forEach((item)=>item.classList.remove('active'));this.navSecciones[menuItem].classList.add('active');this.pageOffset=window.pageYOffset;this.reiniciarAnimacion()}this.comprobarInicio()}comprobarInicio(){if(window.pageYOffset>100){this.btnInicio.classList.remove('oculto')}else{this.btnInicio.classList.add('oculto')}}reiniciarAnimacion(){if(window.pageYOffset==0&&this.portadaNombre){let clonNombre=this.portadaNombre.cloneNode(!0);clonNombre.classList.remove('oculto');clonNombre.classList.add('animacion-nombre');let clonCurriculum=this.portadaCurriculum.cloneNode(!0);clonCurriculum.classList.remove('oculto');clonCurriculum.classList.add('animacion-curriculum');this.portadaNombre.parentNode.replaceChild(clonNombre,this.portadaNombre);this.portadaNombre=clonNombre;this.portadaCurriculum.parentNode.replaceChild(clonCurriculum,this.portadaCurriculum);this.portadaCurriculum=clonCurriculum}}prepararNavegacion(){this.secciones.forEach((item)=>{let cumulative=this.cumulativeOffset(item);this.offsets['#'+item.id]=cumulative})}cumulativeOffset(element){var top=0;do{top+=element.offsetTop||0;element=element.offsetParent}while(element);return top}}class ContactForm{constructor(){this.handlerErrorMessage=new(ErrorMessage);this.oContactForm=document.querySelector('#form-contact');this.oInputNombre=document.querySelector('#name');this.oInputEmail=document.querySelector('#email');this.oSelectConocido=document.querySelector('#como-conocido');this.oConocidoOtros=document.querySelector('#como-conocido-otros');this.oContactNumber=document.querySelector('#contactNumber');this.oTextMessage=document.querySelector('#mensaje');this.oData={nombre:'',email:'',comoConocido:'',comoConocidoOtros:'',numero:'',mensaje:''};this.addEventListeners()};addEventListeners(){this.oSelectConocido.addEventListener('change',this.changeConocido.bind(this));this.oInputNombre.addEventListener('input',this.comprobarCampo);this.oInputNombre.addEventListener('focus',this.comprobarCampo);this.oInputEmail.addEventListener('input',this.comprobarCampo);this.oInputEmail.addEventListener('focus',this.comprobarCampo);this.oInputNombre.addEventListener('focus',this.comprobarCampo);this.oContactNumber.addEventListener('input',this.comprobarCampo);this.oContactNumber.addEventListener('focus',this.comprobarCampo);this.oTextMessage.checkValidity=this.comprobarPalabras;this.oTextMessage.addEventListener('input',this.comprobarCampo);this.oTextMessage.addEventListener('focus',this.comprobarCampo);this.oContactForm.addEventListener('submit',this.validateContactForm.bind(this))};comprobarCampo(event){if(this.checkValidity()){this.classList.remove('invalido')}else{this.classList.add('invalido')}};comprobarPalabras(){const numPalabras=this.value.trim().split(/\s+/).length;return numPalabras<=MAX_WORDS};changeConocido(){if(this.oSelectConocido.value=='otros'){this.oConocidoOtros.classList.remove('oculto');this.oConocidoOtros.focus()}else{this.oConocidoOtros.classList.add('oculto')}};validateContactForm(event){event.preventDefault();if(!this.oInputNombre.checkValidity()){this.handlerErrorMessage.currentFocus=this.oInputNombre;this.handlerErrorMessage.showError('El campo "Nombre" no puede estar vacío');return};if(!this.oInputEmail.checkValidity()){this.handlerErrorMessage.currentFocus=this.oInputEmail;this.handlerErrorMessage.showError('Email incorrecto');return};if(!this.oContactNumber.checkValidity()){this.handlerErrorMessage.currentFocus=this.oContactNumber;this.handlerErrorMessage.showError('Número de contacto incorrecto.\nDebe tener 9 dígitos.');return};if(!this.oTextMessage.checkValidity()){this.handlerErrorMessage.currentFocus=this.oTextMessage;this.handlerErrorMessage.showError(`El mensaje no puede exceder de las ${MAX_WORDS} palabras`);return};this.oContactForm.reset();this.handlerErrorMessage.showError('Mensaje enviado','ok')}}class SmoothScroll{currentYPosition(){if(this.pageYOffset)return this.pageYOffset;if(document.documentElement&&document.documentElement.scrollTop)return document.documentElement.scrollTop;if(document.body.scrollTop)return document.body.scrollTop;return 0}elmYPosition(eID){let elm=document.getElementById(eID);let y=elm.offsetTop;let node=elm;while(node.offsetParent&&node.offsetParent!=document.body){node=node.offsetParent;y+=node.offsetTop}return y-60}smoothScroll(eID){let startY=this.currentYPosition();let stopY=this.elmYPosition(eID);let distance=stopY>startY?stopY-startY:startY-stopY;if(distance<100){scrollTo(0,stopY);return}let speed=Math.round(distance/100);if(speed>=20)speed=20;let step=Math.round(distance/40);let leapY=stopY>startY?startY+step:startY-step;let timer=0;if(stopY>startY){for(let i=startY;i<stopY;i+=step){setTimeout("window.scrollTo(0, "+leapY+")",timer*speed);leapY+=step;if(leapY>stopY)leapY=stopY;timer++}return}for(let i=startY;i>stopY;i-=step){setTimeout("window.scrollTo(0, "+leapY+")",timer*speed);leapY-=step;if(leapY<stopY)leapY=stopY;timer++}}}class ErrorMessage{constructor(){this.oSectionError=document.querySelector('section.section-error-message');this.oCuadroError=document.querySelector('.header-error-message');this.oErrorMessage=document.querySelector('.header-error-message h4');this.oBtnCloseErrorMessage=document.querySelector('#btn-close-message');this.oBtnCloseErrorMessage.addEventListener('click',this.closeErrorMessage.bind(this))};showError(msg,type='error'){if(type==='error'){this.oCuadroError.classList.remove('ok');this.oCuadroError.classList.add('error')}else{this.oCuadroError.classList.add('ok');this.oCuadroError.classList.remove('error')};this.oErrorMessage.innerText=msg;this.oSectionError.classList.add('error-visible')};closeErrorMessage(){if(this.currentFocus){this.currentFocus.focus()};this.oSectionError.classList.remove('error-visible')}}